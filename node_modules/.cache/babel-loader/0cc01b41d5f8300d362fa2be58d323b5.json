{"ast":null,"code":"import _defineProperty from \"/home/its/project/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _regeneratorRuntime from \"/home/its/project/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/home/its/project/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\nvar _mutations;\n\nimport Cookie from 'js-cookie';\nvar SET_TOKEN = 'SET_TOKEN';\nvar LOGAUT = 'LOGAUT';\nvar PROFILE = 'PROFILE';\nexport default {\n  namespaced: true,\n  state: {\n    token: Cookie.get('token') || null,\n    refreshToken: Cookie.get('refreshToken') || null,\n    permissions: Cookie.get('permissions') || null,\n    profile: null,\n    userId: Cookie.get('userId') || null\n  },\n  getters: {\n    token: function token(state) {\n      return state.token;\n    },\n    refreshToken: function refreshToken(state) {\n      return state.refreshToken;\n    },\n    permissions: function permissions(state) {\n      return state.permissions;\n    },\n    profile: function profile(state) {\n      return state.profile;\n    },\n    profileHeader: function profileHeader(state) {\n      if (state.profile) return {\n        Person: state.profile.Person || null,\n        PersonImage: state.profile.PersonImage || null\n      };\n    },\n    userId: function userId(state) {\n      return state.userId;\n    },\n    loggedIn: function loggedIn(state) {\n      return !!state.token;\n    }\n  },\n  actions: {\n    login: function login(_ref, payload) {\n      var _this = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var dispatch, commit, _yield$_this$$rest_ap, data;\n\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                dispatch = _ref.dispatch, commit = _ref.commit;\n                _context.next = 3;\n                return _this.$rest_api.auth.login(payload);\n\n              case 3:\n                _yield$_this$$rest_ap = _context.sent;\n                data = _yield$_this$$rest_ap.data;\n                _context.next = 7;\n                return commit('SET_TOKEN', data.data);\n\n              case 7:\n                _context.next = 9;\n                return dispatch('getProfile', data.data.user.id);\n\n              case 9:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }))();\n    },\n    getProfile: function getProfile(_ref2, payload) {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var state, commit, _yield$_this2$$rest_a, data;\n\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                state = _ref2.state, commit = _ref2.commit;\n                _context2.next = 3;\n                return _this2.$rest_api.persons.get(state.userId);\n\n              case 3:\n                _yield$_this2$$rest_a = _context2.sent;\n                data = _yield$_this2$$rest_a.data;\n                commit('PROFILE', data.data); // return data\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }))();\n    },\n    refreshToken: function () {\n      var _refreshToken = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(_ref3, payload) {\n        var dispatch, _yield$this$$api$auth, data;\n\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                dispatch = _ref3.dispatch;\n                _context3.next = 3;\n                return this.$api.auth.refreshToken(payload);\n\n              case 3:\n                _yield$this$$api$auth = _context3.sent;\n                data = _yield$this$$api$auth.data;\n                _context3.next = 7;\n                return commit('SET_TOKEN', data.data);\n\n              case 7:\n                dispatch('getProfile', data.data.user.id);\n\n              case 8:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function refreshToken(_x, _x2) {\n        return _refreshToken.apply(this, arguments);\n      }\n\n      return refreshToken;\n    }(),\n    logout: function logout(_ref4, payload) {\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        var commit;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                commit = _ref4.commit;\n                // let { data } = await Api.auth.logout.post(payload)\n                // await this.$rest_api.auth.logout(payload)\n                commit('LOGAUT'); // return data\n\n              case 2:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }))();\n    }\n  },\n  mutations: (_mutations = {}, _defineProperty(_mutations, SET_TOKEN, function (state, payload) {\n    if (payload.accessToken !== undefined) {\n      Cookie.set('token', payload.accessToken);\n      Cookie.set('refreshToken', payload.refreshToken);\n      Cookie.set('permissions', payload.user.permissions);\n      Cookie.set('userId', payload.user.id);\n      state.token = payload.accessToken;\n      state.refreshToken = payload.refreshToken;\n      state.permissions = payload.user.permissions;\n      state.userId = payload.user.id;\n    }\n  }), _defineProperty(_mutations, PROFILE, function (state, payload) {\n    state.profile = payload;\n  }), _defineProperty(_mutations, LOGAUT, function (state) {\n    console.log('mutation');\n    Cookie.remove('token');\n    Cookie.remove('refreshToken');\n    Cookie.remove('permissions');\n    Cookie.remove('userId');\n    state.token = null;\n    state.refreshToken = null;\n    state.permissions = null;\n    state.userId = null;\n  }), _mutations)\n};","map":{"version":3,"names":["Cookie","SET_TOKEN","LOGAUT","PROFILE","namespaced","state","token","get","refreshToken","permissions","profile","userId","getters","profileHeader","Person","PersonImage","loggedIn","actions","login","payload","dispatch","commit","$rest_api","auth","data","user","id","getProfile","persons","$api","logout","mutations","accessToken","undefined","set","console","log","remove"],"sources":["/home/its/project/src/store/auth.js"],"sourcesContent":["import Cookie from 'js-cookie';\n\nconst SET_TOKEN = 'SET_TOKEN'\nconst LOGAUT = 'LOGAUT'\nconst PROFILE = 'PROFILE'\n\nexport default {\n  namespaced: true,\n  state: {\n      token: Cookie.get('token') || null,\n      refreshToken: Cookie.get('refreshToken') || null,\n      permissions: Cookie.get('permissions') || null,\n      profile: null,\n      userId: Cookie.get('userId') || null\n  },\n\n  getters: {\n    token: state => state.token,\n    refreshToken: state => state.refreshToken,\n    permissions: state => state.permissions,\n    profile: state => state.profile,\n    profileHeader: state => {\n      if (state.profile)\n      return {\n        Person: state.profile.Person || null,\n        PersonImage: state.profile.PersonImage || null\n      }\n    },\n    userId: state => state.userId,\n    loggedIn: state => !!state.token\n  },\n\n  actions: {\n    async login({dispatch, commit}, payload) {\n      let { data } = await this.$rest_api.auth.login(payload)\n      await commit('SET_TOKEN', data.data)\n      await dispatch('getProfile', data.data.user.id)\n      // return data\n    },\n    async getProfile({state, commit}, payload) {\n      let { data } = await this.$rest_api.persons.get(state.userId)\n      commit('PROFILE', data.data)\n      // return data\n    },\n    refreshToken: async function({dispatch}, payload) {\n      let {data} = await this.$api.auth.refreshToken(payload);\n      await commit('SET_TOKEN', data.data)\n      dispatch('getProfile', data.data.user.id)\n    },\n    async logout({commit}, payload) {\n      // let { data } = await Api.auth.logout.post(payload)\n      // await this.$rest_api.auth.logout(payload)\n      commit('LOGAUT')\n      // return data\n    },\n  },\n  mutations: {\n    [SET_TOKEN](state, payload) {\n      if (payload.accessToken !== undefined) {\n        Cookie.set('token', payload.accessToken)\n        Cookie.set('refreshToken', payload.refreshToken)\n        Cookie.set('permissions', payload.user.permissions)\n        Cookie.set('userId', payload.user.id)\n        state.token = payload.accessToken\n        state.refreshToken = payload.refreshToken\n        state.permissions = payload.user.permissions\n        state.userId = payload.user.id\n      }\n    },\n    [PROFILE](state, payload) {\n        state.profile = payload\n    },\n    [LOGAUT](state) {\n      console.log('mutation')\n      Cookie.remove('token')\n      Cookie.remove('refreshToken')\n      Cookie.remove('permissions')\n      Cookie.remove('userId')\n      state.token = null\n      state.refreshToken = null\n      state.permissions = null\n      state.userId = null\n    }\n  },\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}