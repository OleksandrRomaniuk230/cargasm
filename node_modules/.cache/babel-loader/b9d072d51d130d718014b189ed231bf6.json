{"ast":null,"code":"import _defineProperty from \"/home/its/project/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _regeneratorRuntime from \"/home/its/project/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/home/its/project/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\nvar _mutations;\n\nimport Cookie from 'js-cookie';\nvar SET_TOKEN = 'SET_TOKEN';\nexport default {\n  namespaced: true,\n  state: {\n    token: Cookie.get('token') || null\n  },\n  getters: {\n    token: function token(state) {\n      return state.token;\n    }\n  },\n  actions: {\n    login: function login(_ref, payload) {\n      var _this = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var dispatch, commit, _yield$_this$$rest_ap, data;\n\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                dispatch = _ref.dispatch, commit = _ref.commit;\n                _context.next = 3;\n                return _this.$rest_api.auth.login(payload);\n\n              case 3:\n                _yield$_this$$rest_ap = _context.sent;\n                data = _yield$_this$$rest_ap.data;\n                _context.next = 7;\n                return commit('SET_TOKEN', data.data);\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }))();\n    },\n    getProfile: function getProfile(_ref2, payload) {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var state, commit, _yield$_this2$$rest_a, data;\n\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                state = _ref2.state, commit = _ref2.commit;\n                _context2.next = 3;\n                return _this2.$rest_api.persons.get(state.userId);\n\n              case 3:\n                _yield$_this2$$rest_a = _context2.sent;\n                data = _yield$_this2$$rest_a.data;\n                commit('PROFILE', data.data); // return data\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }))();\n    },\n    refreshToken: function () {\n      var _refreshToken = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(_ref3, payload) {\n        var dispatch, _yield$this$$api$auth, data;\n\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                dispatch = _ref3.dispatch;\n                _context3.next = 3;\n                return this.$api.auth.refreshToken(payload);\n\n              case 3:\n                _yield$this$$api$auth = _context3.sent;\n                data = _yield$this$$api$auth.data;\n                _context3.next = 7;\n                return commit('SET_TOKEN', data.data);\n\n              case 7:\n                dispatch('getProfile', data.data.user.id);\n\n              case 8:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function refreshToken(_x, _x2) {\n        return _refreshToken.apply(this, arguments);\n      }\n\n      return refreshToken;\n    }(),\n    logout: function logout(_ref4, payload) {\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        var commit;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                commit = _ref4.commit;\n                // let { data } = await Api.auth.logout.post(payload)\n                // await this.$rest_api.auth.logout(payload)\n                commit('LOGAUT'); // return data\n\n              case 2:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }))();\n    }\n  },\n  mutations: (_mutations = {}, _defineProperty(_mutations, SET_TOKEN, function (state, payload) {\n    if (payload.accessToken !== undefined) {\n      Cookie.set('token', payload.accessToken);\n      Cookie.set('refreshToken', payload.refreshToken);\n      Cookie.set('permissions', payload.user.permissions);\n      Cookie.set('userId', payload.user.id);\n      state.token = payload.accessToken;\n      state.refreshToken = payload.refreshToken;\n      state.permissions = payload.user.permissions;\n      state.userId = payload.user.id;\n    }\n  }), _defineProperty(_mutations, PROFILE, function (state, payload) {\n    state.profile = payload;\n  }), _defineProperty(_mutations, LOGAUT, function (state) {\n    console.log('mutation');\n    Cookie.remove('token');\n    Cookie.remove('refreshToken');\n    Cookie.remove('permissions');\n    Cookie.remove('userId');\n    state.token = null;\n    state.refreshToken = null;\n    state.permissions = null;\n    state.userId = null;\n  }), _mutations)\n};","map":{"version":3,"names":["Cookie","SET_TOKEN","namespaced","state","token","get","getters","actions","login","payload","dispatch","commit","$rest_api","auth","data","getProfile","persons","userId","refreshToken","$api","user","id","logout","mutations","accessToken","undefined","set","permissions","PROFILE","profile","LOGAUT","console","log","remove"],"sources":["/home/its/project/src/store/auth.js"],"sourcesContent":["import Cookie from 'js-cookie';\n\nconst SET_TOKEN = 'SET_TOKEN'\n\n\nexport default {\n  namespaced: true,\n  state: {\n      token: Cookie.get('token') || null,\n  },\n\n  getters: {\n    token: state => state.token,\n  },\n\n  actions: {\n    async login({dispatch, commit}, payload) {\n      let { data } = await this.$rest_api.auth.login(payload)\n      await commit('SET_TOKEN', data.data)\n      // return data\n    },\n    async getProfile({state, commit}, payload) {\n      let { data } = await this.$rest_api.persons.get(state.userId)\n      commit('PROFILE', data.data)\n      // return data\n    },\n    refreshToken: async function({dispatch}, payload) {\n      let {data} = await this.$api.auth.refreshToken(payload);\n      await commit('SET_TOKEN', data.data)\n      dispatch('getProfile', data.data.user.id)\n    },\n    async logout({commit}, payload) {\n      // let { data } = await Api.auth.logout.post(payload)\n      // await this.$rest_api.auth.logout(payload)\n      commit('LOGAUT')\n      // return data\n    },\n  },\n  mutations: {\n    [SET_TOKEN](state, payload) {\n      if (payload.accessToken !== undefined) {\n        Cookie.set('token', payload.accessToken)\n        Cookie.set('refreshToken', payload.refreshToken)\n        Cookie.set('permissions', payload.user.permissions)\n        Cookie.set('userId', payload.user.id)\n        state.token = payload.accessToken\n        state.refreshToken = payload.refreshToken\n        state.permissions = payload.user.permissions\n        state.userId = payload.user.id\n      }\n    },\n    [PROFILE](state, payload) {\n        state.profile = payload\n    },\n    [LOGAUT](state) {\n      console.log('mutation')\n      Cookie.remove('token')\n      Cookie.remove('refreshToken')\n      Cookie.remove('permissions')\n      Cookie.remove('userId')\n      state.token = null\n      state.refreshToken = null\n      state.permissions = null\n      state.userId = null\n    }\n  },\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}