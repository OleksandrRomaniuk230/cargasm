{"ast":null,"code":"import _regeneratorRuntime from \"/home/its/project/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/home/its/project/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.split.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nexport default {\n  props: {\n    clearphoto: {\n      type: Boolean,\n      default: true\n    }\n  },\n  data: function data() {\n    return {\n      preview: null,\n      image: null\n    };\n  },\n  methods: {\n    uploadFile: function uploadFile(e) {\n      var _this = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var photos, self, item, preview, image, block, contentType, realData, blob;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                photos = e.target.files;\n                self = _this;\n                _context.t0 = _regeneratorRuntime().keys(photos);\n\n              case 3:\n                if ((_context.t1 = _context.t0()).done) {\n                  _context.next = 40;\n                  break;\n                }\n\n                item = _context.t1.value;\n                _context.prev = 5;\n                _context.next = 8;\n                return self.$convertToBase64(photos[item]);\n\n              case 8:\n                preview = _context.sent;\n                self.file = photos[item];\n                _context.prev = 10;\n                _context.next = 13;\n                return Jimp.read(preview);\n\n              case 13:\n                image = _context.sent;\n                _context.prev = 14;\n                image.background(0xffffffff);\n                _context.next = 18;\n                return image.getBase64Async(Jimp.MIME_JPEG);\n\n              case 18:\n                self.preview = _context.sent;\n                block = self.preview.split(\";\");\n                contentType = block[0].split(\":\")[1];\n                realData = block[1].split(\",\")[1];\n                blob = self.$b64toBlob(realData, contentType);\n                self.file = new File([blob], photos[item].name, {\n                  type: blob.type\n                });\n\n                _this.photos.unshift({\n                  photo: {\n                    default: self.preview\n                  },\n                  file: self.file\n                });\n\n                _context.next = 29;\n                break;\n\n              case 27:\n                _context.prev = 27;\n                _context.t2 = _context[\"catch\"](14);\n\n              case 29:\n                _context.next = 33;\n                break;\n\n              case 31:\n                _context.prev = 31;\n                _context.t3 = _context[\"catch\"](10);\n\n              case 33:\n                _context.next = 37;\n                break;\n\n              case 35:\n                _context.prev = 35;\n                _context.t4 = _context[\"catch\"](5);\n\n              case 37:\n                _this.$emit(\"photo\", _this.image);\n\n                _context.next = 3;\n                break;\n\n              case 40:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[5, 35], [10, 31], [14, 27]]);\n      }))();\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA;EACAA;IACAC;MACAC,aADA;MAEAC;IAFA;EADA,CADA;EAOAC,IAPA,kBAOA;IACA;MACAC,aADA;MAEAC;IAFA;EAIA,CAZA;EAaAC;IACAC,UADA,sBACAC,CADA,EACA;MAAA;;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACAC,MADA,GACAD,cADA;gBAEAE,IAFA,GAEA,KAFA;gBAAA,yCAGAD,MAHA;;cAAA;gBAAA;kBAAA;kBAAA;gBAAA;;gBAGAE,IAHA;gBAAA;gBAAA;gBAAA,OAKAD,mCALA;;cAAA;gBAKAN,OALA;gBAMAM;gBANA;gBAAA;gBAAA,OAQAE,kBARA;;cAAA;gBAQAP,KARA;gBAAA;gBAUAA;gBAVA;gBAAA,OAWAA,oCAXA;;cAAA;gBAWAK,YAXA;gBAYAG,KAZA,GAYAH,uBAZA;gBAaAI,WAbA,GAaAD,sBAbA;gBAcAE,QAdA,GAcAF,sBAdA;gBAeAG,IAfA,GAeAN,sCAfA;gBAgBAA;kBACAT;gBADA;;gBAGA;kBACAgB;oBAAAf;kBAAA,CADA;kBAEAgB;gBAFA;;gBAnBA;gBAAA;;cAAA;gBAAA;gBAAA;;cAAA;gBAAA;gBAAA;;cAAA;gBAAA;gBAAA;;cAAA;gBAAA;gBAAA;;cAAA;gBAAA;gBAAA;;cAAA;gBA4BA;;gBA5BA;gBAAA;;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IA6BA;EA9BA;AAbA","names":["props","clearphoto","type","default","data","preview","image","methods","uploadFile","e","photos","self","item","Jimp","block","contentType","realData","blob","photo","file"],"sourceRoot":"src/components/fields","sources":["AppAddPhoto.vue"],"sourcesContent":["<template>\n  <div class=\"photo-add\">\n    <img v-if=\"preview && clearphoto\" :src=\"preview\" class=\"photo-add__img\" />\n    <label v-else class=\"photo-add__label\">\n      <svg\n        width=\"80\"\n        height=\"80\"\n        viewBox=\"0 0 80 80\"\n        fill=\"none\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <path\n          d=\"M73.334 53.334V13.334C73.329 11.5673 72.625 9.87447 71.3757 8.62525C70.1265 7.37603 68.4336 6.67201 66.667 6.66699H26.667C24.9003 6.67201 23.2075 7.37603 21.9583 8.62525C20.709 9.87447 20.005 11.5673 20 13.334V53.334C20.0053 55.1005 20.7094 56.7931 21.9586 58.0421C23.2078 59.2911 24.9005 59.995 26.667 60H66.667C68.4335 59.995 70.1262 59.2911 71.3754 58.0421C72.6246 56.7931 73.3287 55.1005 73.334 53.334ZM36.667 40L43.434 49.033L53.334 36.667L66.667 53.334H26.667L36.667 40ZM6.66699 20V66.667C6.67201 68.4336 7.37603 70.1265 8.62525 71.3757C9.87447 72.625 11.5673 73.329 13.334 73.334H60V66.667H13.334V20H6.66699Z\"\n          fill=\"#D7DCDE\"\n        />\n      </svg>\n      <button>+ Добавить фото</button></label\n    >\n    <input\n      @change=\"uploadFile\"\n      type=\"file\"\n      ref=\"file\"\n      class=\"photo-add__file\"\n    />\n  </div>\n</template>\n<script>\nexport default {\n  props: {\n    clearphoto: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  data() {\n    return {\n      preview: null,\n      image: null,\n    };\n  },\n  methods: {\n    async uploadFile(e) {\n      let photos = e.target.files;\n      let self = this;\n      for (let item in photos) {\n        try {\n          let preview = await self.$convertToBase64(photos[item]);\n          self.file = photos[item];\n          try {\n            let image = await Jimp.read(preview);\n            try {\n              image.background(0xffffffff);\n              self.preview = await image.getBase64Async(Jimp.MIME_JPEG);\n              let block = self.preview.split(\";\");\n              let contentType = block[0].split(\":\")[1];\n              let realData = block[1].split(\",\")[1];\n              let blob = self.$b64toBlob(realData, contentType);\n              self.file = new File([blob], photos[item].name, {\n                type: blob.type,\n              });\n              this.photos.unshift({\n                photo: { default: self.preview },\n                file: self.file,\n              });\n            } catch (e) {}\n          } catch (e) {}\n        } catch (e) {\n        }\n\n      this.$emit(\"photo\", this.image);\n      }}\n  },\n};\n</script>"]},"metadata":{},"sourceType":"module"}