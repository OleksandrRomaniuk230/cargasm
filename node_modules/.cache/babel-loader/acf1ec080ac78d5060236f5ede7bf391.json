{"ast":null,"code":"import _regeneratorRuntime from \"/home/its/project/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/home/its/project/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport RestClientaxios from 'axios-rest-client';\nimport Cookies from 'js-cookie';\nimport Vue from 'vue';\nvar token = Cookies.get('token');\nvar api = axiosRestClient({\n  baseUrl: process.env.NUXT_APP_API_URL || '/api/'\n});\nvar headers = {\n  'Accept': 'application/json',\n  'Content-Type': 'application/json',\n  'X-localization': Cookies.get('language')\n};\n\nif (token || null) {\n  headers = Object.assign({\n    'Authorization': \"Bearer \".concat(token)\n  }, headers);\n} // api.axios().defaults.withCredentials = true\n\n\napi.axios().defaults.headers.common = headers;\napi.axios().interceptors.response.use(function (response) {\n  return response;\n}, /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(error) {\n    var st;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            st = error.response && error.response.status || null;\n\n            if (!(st === 422)) {\n              _context.next = 5;\n              break;\n            }\n\n            return _context.abrupt(\"return\", Promise.reject( //   {\n            //   // status: 422,\n            //   // data: error.response.data.errors,\n            //   // message: 'Ввод полей не корректен!'\n            // }\n            new ValidationErrors(error.response)));\n\n          case 5:\n            if (!(st === 406)) {\n              _context.next = 9;\n              break;\n            }\n\n            return _context.abrupt(\"return\", Promise.reject(error.response));\n\n          case 9:\n            if (!(st === 400)) {\n              _context.next = 13;\n              break;\n            }\n\n            return _context.abrupt(\"return\", Promise.reject(error.response));\n\n          case 13:\n            if (!(st === 404)) {\n              _context.next = 17;\n              break;\n            }\n\n            return _context.abrupt(\"return\", Promise.reject({\n              status: st,\n              message: 'Старница не найдена'\n            }));\n\n          case 17:\n            if (!(st === 403)) {\n              _context.next = 21;\n              break;\n            }\n\n            return _context.abrupt(\"return\", Promise.reject(error.response));\n\n          case 21:\n            if (!(st === 401)) {\n              _context.next = 27;\n              break;\n            }\n\n            Cookies.remove('token');\n            Cookies.remove('role'); // location.href = '/'\n\n            return _context.abrupt(\"return\", Promise.reject({\n              status: st,\n              message: 'Доступ запрещен'\n            }));\n\n          case 27:\n            Vue.toasted.show('Ошибка сервера', {\n              theme: \"outline\",\n              position: \"bottom-right\",\n              type: \"danger\",\n              icon: \"check\",\n              duration: 3000\n            });\n            return _context.abrupt(\"return\", Promise.reject({\n              status: 500,\n              message: 'Ошибка сервера'\n            }));\n\n          case 29:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x) {\n    return _ref.apply(this, arguments);\n  };\n}());\nexport var Api = api;\nexport default (function (context, inject) {\n  inject('api', api);\n});","map":{"version":3,"names":["RestClientaxios","Cookies","Vue","token","get","api","axiosRestClient","baseUrl","process","env","NUXT_APP_API_URL","headers","Object","assign","axios","defaults","common","interceptors","response","use","error","st","status","Promise","reject","ValidationErrors","message","remove","toasted","show","theme","position","type","icon","duration","Api","context","inject"],"sources":["/home/its/project/src/plugins/axios-rest-client.js"],"sourcesContent":["import RestClientaxios from 'axios-rest-client'\nimport Cookies from 'js-cookie'\n\nimport Vue from 'vue'\n\nconst token = Cookies.get('token')\n\nconst api = axiosRestClient({\n  baseUrl: process.env.NUXT_APP_API_URL || '/api/',\n})\n\nlet headers = {\n  'Accept': 'application/json',\n  'Content-Type': 'application/json',\n  'X-localization': Cookies.get('language'),\n}\n\nif (token || null) {\n  headers = Object.assign({\n    'Authorization': `Bearer ${token}`\n  }, headers)\n}\n\n// api.axios().defaults.withCredentials = true\napi.axios().defaults.headers.common = headers\n\napi.axios().interceptors.response.use((response) => {\n    return response\n  },\n  async (error) => {\n    let st = error.response && error.response.status || null\n    if (st === 422) {\n      return Promise.reject(\n        //   {\n        //   // status: 422,\n        //   // data: error.response.data.errors,\n        //   // message: 'Ввод полей не корректен!'\n        // }\n        new ValidationErrors(error.response)\n      )\n    } else if (st === 406) {\n      return Promise.reject(error.response)\n    } else if (st === 400) {\n      return Promise.reject(error.response)\n    } else if (st === 404) {\n      return Promise.reject({\n        status: st,\n        message: 'Старница не найдена'\n      })\n    } else if (st === 403) {\n      return Promise.reject(error.response)\n      // return Promise.reject({\n      //   status: st,\n      //   message: 'Доступ запрещен'\n      // })\n    } else if (st === 401) {\n      Cookies.remove('token')\n      Cookies.remove('role')\n      // location.href = '/'\n      return Promise.reject({\n        status: st,\n        message: 'Доступ запрещен'\n      })\n    } else {\n      Vue.toasted.show('Ошибка сервера', {\n        theme: \"outline\",\n        position: \"bottom-right\",\n        type: \"danger\",\n        icon: \"check\",\n        duration: 3000\n      });\n      return Promise.reject({\n        status: 500,\n        message: 'Ошибка сервера'\n      })\n    }\n  })\n\nexport const Api = api\n\nexport default (context, inject) => {\n  inject('api', api)\n}\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}