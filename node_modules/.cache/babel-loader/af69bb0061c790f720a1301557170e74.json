{"ast":null,"code":"import _regeneratorRuntime from \"/home/its/project/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/home/its/project/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport axios from 'axios';\nimport _ from 'lodash';\nimport apiEvent from './modules/api/event';\n\nfunction cleanRestApi(obj) {\n  for (var propName in obj) {\n    if (!obj.hasOwnProperty(propName)) continue;\n  }\n}\n\nexport default (function (ctx, inject) {\n  var client = axios.create({\n    baseURL: process.env.NUXT_APP_API_URL || 'http://localhost:5000/api/v1/'\n  });\n  client.interceptors.request.use( /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(config) {\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (config.method === 'put' || config.method === 'post') {\n                cleanRestApi(config.data);\n              }\n\n              if (ctx.app.$cookies.get('token')) {\n                config.headers.common['Authorization'] = \"Bearer \".concat(ctx.app.$cookies.get(\"token\"));\n              }\n\n              return _context.abrupt(\"return\", config);\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }(), /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(error) {\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              return _context2.abrupt(\"return\", Promise.reject(error));\n\n            case 1:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }());\n  client.interceptors.response.use( /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(response) {\n      return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              return _context3.abrupt(\"return\", response);\n\n            case 1:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function (_x3) {\n      return _ref3.apply(this, arguments);\n    };\n  }(), /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(error) {\n      var code;\n      return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              code = error.response && error.response.status ? error.response.status : 500;\n\n              if (!(code === 422)) {\n                _context4.next = 3;\n                break;\n              }\n\n              return _context4.abrupt(\"return\", Promise.reject({\n                status: code,\n                errors: error.response.data.errors\n              }));\n\n            case 3:\n              if (!(code === 410)) {\n                _context4.next = 5;\n                break;\n              }\n\n              return _context4.abrupt(\"return\", Promise.reject({\n                status: 410,\n                message: error.response.data.message\n              }));\n\n            case 5:\n              if (!(code === 404)) {\n                _context4.next = 8;\n                break;\n              }\n\n              ctx.error({\n                message: 'Страница не найдена!',\n                statusCode: code\n              });\n              return _context4.abrupt(\"return\", Promise.reject({\n                status: 404,\n                message: error.response.data.message\n              }));\n\n            case 8:\n              if (!(code === 403)) {\n                _context4.next = 11;\n                break;\n              }\n\n              ctx.error({\n                message: 'Доступ запрещен!',\n                statusCode: code\n              });\n              return _context4.abrupt(\"return\", Promise.reject({\n                status: 403,\n                message: error.response.data.message\n              }));\n\n            case 11:\n              if (!(code === 401)) {\n                _context4.next = 14;\n                break;\n              }\n\n              ctx.redirect({\n                path: '/'\n              });\n              return _context4.abrupt(\"return\", Promise.reject({\n                status: 401,\n                message: error.response.data.message\n              }));\n\n            case 14:\n              if (!(code === 400)) {\n                _context4.next = 16;\n                break;\n              }\n\n              return _context4.abrupt(\"return\", Promise.reject({\n                status: 400,\n                message: error.response.data.message\n              }));\n\n            case 16:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function (_x4) {\n      return _ref4.apply(this, arguments);\n    };\n  }());\n  var repositories = {\n    event: apiEvent(client)\n  };\n  inject('rest_api', repositories);\n  ctx.app.$rest_api = repositories;\n  return ctx;\n});","map":{"version":3,"names":["axios","_","apiEvent","cleanRestApi","obj","propName","hasOwnProperty","ctx","inject","client","create","baseURL","process","env","NUXT_APP_API_URL","interceptors","request","use","config","method","data","app","$cookies","get","headers","common","error","Promise","reject","response","code","status","errors","message","statusCode","redirect","path","repositories","event","$rest_api"],"sources":["/home/its/project/src/plugins/api.js"],"sourcesContent":["import axios from 'axios';\nimport _ from 'lodash';\nimport apiEvent from './modules/api/event';\n\n\nfunction cleanRestApi(obj) {\n    for (const propName in obj) {\n        if (!obj.hasOwnProperty(propName)) continue;\n    }\n}\nexport default (ctx, inject) => {\n    let client = axios.create({\n        baseURL: process.env.NUXT_APP_API_URL || 'http://localhost:5000/api/v1/'\n    })\n    client.interceptors.request.use(async config => {\n        if (config.method === 'put' || config.method === 'post') {\n            cleanRestApi(config.data);\n        }\n        if (ctx.app.$cookies.get('token')) {\n\n            config.headers.common['Authorization'] = `Bearer ${ctx.app.$cookies.get(\n                \"token\"\n            )}`;\n        }\n\n        return config;\n    }, async error => {\n        return Promise.reject(error);\n    });\n\n    client.interceptors.response.use(async response => {\n        return response;\n    }, async(error) => {\n\n        let code = error.response && error.response.status ? error.response.status : 500;\n\n        if (code === 422) {\n            return Promise.reject({\n                status: code,\n                errors: error.response.data.errors\n            });\n        }\n        if (code === 410) {\n            return Promise.reject({\n                status: 410,\n                message: error.response.data.message\n            });\n        }\n        if (code === 404) {\n            ctx.error({ message: 'Страница не найдена!', statusCode: code })\n            return Promise.reject({\n                status: 404,\n                message: error.response.data.message\n            });\n        }\n        if (code === 403) {\n            ctx.error({ message: 'Доступ запрещен!', statusCode: code })\n            return Promise.reject({\n                status: 403,\n                message: error.response.data.message\n            });\n        }\n        if (code === 401) {\n            ctx.redirect({\n                path: '/'\n            })\n\n            return Promise.reject({\n                status: 401,\n                message: error.response.data.message\n            });\n        }\n\n        if (code === 400) {\n            return Promise.reject({\n                status: 400,\n                message: error.response.data.message\n            });\n        }\n    });\n\n\n    const repositories = {\n        event: apiEvent(client),\n\n    };\n    inject('rest_api', repositories);\n    ctx.app.$rest_api = repositories;\n    return ctx;\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}